-- Khai báo các dịch vụ cần thiết
local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local camera = workspace.CurrentCamera

getgenv().SecureMode = false
local ArrayField = loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3AArrayfield%20Library"))()

local Window = ArrayField:CreateWindow({
    Name = "Game Hub",
    LoadingTitle = "Loading...",
    LoadingSubtitle = "Script by khang",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "KhangHGGui",
        FileName = "KhangHubKK"
    },
    Discord = {
        Enabled = false,
        Invite = "sirius",
        RememberJoins = true
    },
    KeySystem = true,
    KeySettings = {
        Title = "KhangHub",
        Subtitle = "Key System",
        Note = "Ytub: KhangRobloxScr",
        FileName = "KGameHKeys",
        SaveKey = true,
        GrabKeyFromSite = false,
        AutoCheck = true,
        Key = {"Hello", "Bye"},
        Actions = {
            [1] = {
                Text = 'Click here to getkey',
                OnPress = function()
                    setclipboard("Hello")
                end,
            }
        },
    }
})







-- Tạo hàm ESP chung
local function autoESP(filterFn, color, labelText)
	task.spawn(function()
		while true do
			for _, obj in ipairs(workspace:GetDescendants()) do
				if filterFn(obj) then
					if not obj:FindFirstChild("AutoESP") then
						local hl = Instance.new("Highlight")
						hl.Name = "AutoESP"
						hl.OutlineColor = color
						hl.OutlineTransparency = 0
						hl.FillTransparency = 1
						hl.Parent = obj
					end
					if not obj:FindFirstChild("ESPLabel") and obj:IsA("BasePart") then
						local bill = Instance.new("BillboardGui", obj)
						bill.Name = "ESPLabel"
						bill.Size = UDim2.new(0, 100, 0, 40)
						bill.StudsOffset = Vector3.new(0, 2, 0)
						bill.AlwaysOnTop = true
						local txt = Instance.new("TextLabel", bill)
						txt.Size = UDim2.new(1, 0, 1, 0)
						txt.BackgroundTransparency = 1
						txt.TextColor3 = color
						txt.TextStrokeTransparency = 0.5
						txt.Text = labelText or obj.Name
						txt.Font = Enum.Font.Bodoni
						txt.TextScaled = true
					end
				end
			end
			task.wait(5)
		end
	end)
end








local Default = Window:CreateTab("Default")
local Tab = Window:CreateTab("Trench War", 6034985497)
local Tab2 = Window:CreateTab("Vacation ✈️ (Story)", 6034985497)
local Tab3 = Window:CreateTab("The $1,000,000 Glass Bridge", 6034985497)
local Mtab = Window:CreateTab("Misc")








-- Default
local Defaultinfo = Default:CreateSection("Info", false)

Default:CreateParagraph({
    Title = "This Script",
    Content = "Script made by Khang | Ytub: KhangRobloxScr\nUsername: concacrobloxntkphuh"
}, Defaultinfo) -- Section này là section thật (false), KHÔNG phải Label

Default:CreateParagraph({
    Title = "Version",
    Content = "-- Version 1.0 --"
}, Defaultinfo) -- Section này là section thật (false), KHÔNG phải Label





-- Tab
local T1 = Tab:CreateSection("Main", false)

-- Tạo bảng chứa tất cả element cần khóa
local TW = {} -- Trench War Elements

-- Nút 1
TW[#TW+1] = Tab:CreateButton({
    Name = "No cooldown",
    SectionParent = T1,
    Interact = "Run",
    Callback = function()
        g = hookfunction(wait, function(seconds)
            return g(0)
        end)
    end
})

-- Nút 2
TW[#TW+1] = Tab:CreateButton({
    Name = "Hitbox Gui",
    SectionParent = T1,
    Interact = "Run",
    Callback = function()
        loadstring(game:HttpGet("https://scriptblox.com/raw/Universal-Script-hitbox-expander-real-good-7163"))()
    end
})

local T2 = Tab:CreateSection("Misc", false)

TW[#TW+1] = Tab:CreateButton({
    Name = "TrenchWar Gui",
    SectionParent = T2,
    Interact = "Run",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/twFnI1wv/raw"))()
    end
})


-- Khóa các nút nếu không đúng game.PlaceId
if game.PlaceId ~= 6654918151 then
    task.defer(function()
        for _, element in pairs(TW) do
            element:Lock("In Game only")
        end
    end)
end







-- Tạo bảng chứa tất cả element cần khóa
local VacationST = {} -- Vacation ✈️ (Story) Elements

-- Tab2 
local T2T = Tab2:CreateSection("Main", false)

VacationST[#VacationST+1] = Tab2:CreateToggle({
    Name = "Auto Respawn",
    SectionParent = T2T,
    CurrentValue = false,
    Callback = function(state)
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer

        -- Hàm thiết lập sự kiện khi nhân vật spawn
        local function SetupAutoRespawn()
            if VacationST._DiedConnection then
                VacationST._DiedConnection:Disconnect()
            end

            local Character = LocalPlayer.Character
            if not Character then return end

            local Humanoid = Character:FindFirstChildOfClass("Humanoid")
            if not Humanoid then return end

            VacationST._DiedConnection = Humanoid.Died:Connect(function()
                task.wait(1)
                game:GetService("ReplicatedStorage").Respawn:FireServer()
            end)
        end

        if state then
            -- Kết nối lại mỗi lần nhân vật mới được tạo
            VacationST._CharConn = LocalPlayer.CharacterAdded:Connect(function()
                task.wait(1) -- đợi nhân vật fully loaded
                SetupAutoRespawn()
            end)

            -- Thiết lập lần đầu nếu đã có character
            if LocalPlayer.Character then
                SetupAutoRespawn()
            end
        else
            -- Gỡ kết nối khi tắt
            if VacationST._CharConn then
                VacationST._CharConn:Disconnect()
                VacationST._CharConn = nil
            end
            if VacationST._DiedConnection then
                VacationST._DiedConnection:Disconnect()
                VacationST._DiedConnection = nil
            end
        end
    end
})


VacationST[#VacationST+1] = Tab2:CreateButton({
    Name = "Esp Log",
    SectionParent = T2T,
    Interact = "Run",
    Callback = function()
        autoESP(function(p)
			return p:IsA("BasePart") and p.Name == "Log"
		end, Color3.fromRGB(140, 75, 0), "Log")
    end
})



-- Khóa các nút nếu không đúng game.PlaceId
if game.PlaceId ~= 3703119491 then
    task.defer(function()
        for _, element in pairs(VacationST) do
            element:Lock("In Game only")
        end
    end)
end











local mSgl = {} -- The $1,000,000 Glass Bridge Elements
-- Tab3
local T3T = Tab3:CreateSection("Main", false)
local T3T2 = Tab3:CreateSection("Money", false)

-- Glass wall highlight
mSgl[#mSgl+1] = Tab3:CreateButton({
    Name = "Glass ESP",
    SectionParent = T3T,
    Interact = "Run",
    Callback = function()
        task.spawn(function()
            while true do
                if workspace:FindFirstChild("Glasses") then
                    local glasses = workspace.Glasses
                    if glasses:FindFirstChild("Wrong") and glasses:FindFirstChild("Correct") then
                        local wrongChildren = glasses.Wrong:GetChildren()
                        local correctChildren = glasses.Correct:GetChildren()

                        for i = 1, 1000 do
                            if wrongChildren[i] and wrongChildren[i]:IsA("BasePart") then
                                wrongChildren[i].Color = Color3.new(1, 0, 0) -- đỏ
                            end
                            if correctChildren[i] and correctChildren[i]:IsA("BasePart") then
                                correctChildren[i].Color = Color3.new(0, 1, 0) -- xanh
                            end
                        end
                    end
                end
                task.wait(0.1)
            end
        end)
    end
})

-- Toggle Auto Wins
local isAutoEzActive = false
mSgl[#mSgl+1] = Tab3:CreateToggle({
    Name = "Auto Wins",
    SectionParent = T3T,
    CurrentValue = false,
    Callback = function(value)
        isAutoEzActive = value
        task.spawn(function()
            while isAutoEzActive do
                local args = {
                    [1] = game:GetService("Players").LocalPlayer
                }
                game:GetService("ReplicatedStorage").GiveClaimMoney:FireServer(unpack(args))
                task.wait(1)
            end
        end)
    end
})

-- Textbox để nhập số tiền cần xoá
mSgl[#mSgl+1] = Tab3:CreateInput({
    Name = "Free money",
    SectionParent = T3T2,
    PlaceholderText = "Enter amount",
    Callback = function(text)
        local num = tonumber(text)
        if num then
            num = -num
            local args = {
                [1] = tostring(num)
            }
            game:GetService("ReplicatedStorage").CratesUtilities.Remotes.RemoveMoney:FireServer(unpack(args))
        end
    end
})

mSgl[#mSgl+1] = Tab3:CreateButton({
    Name = "Get 3 OP tool",
    SectionParent = T3T,
    Interact = "Run",
    Callback = function()
        for i = 1, 10 do
local Players = game:GetService("Players")
local args = {
    Players.LocalPlayer
}
game:GetService("ReplicatedStorage"):WaitForChild("FreeGearEvent"):FireServer(unpack(args))
end
    end
})

-- Nút fix tiền (xoá sạch)
mSgl[#mSgl+1] = Tab3:CreateButton({
    Name = "Fix Money",
    SectionParent = T3T2,
    Interact = "Run",
    Callback = function()
        local args = {
            [1] = -9223372036854776000
        }
        game:GetService("ReplicatedStorage").CratesUtilities.Remotes.RemoveMoney:FireServer(unpack(args))
    end
})


-- Khóa các nút nếu không đúng game.PlaceId
if game.PlaceId ~= 87854376962069 then
    task.defer(function()
        for _, element in pairs(mSgl) do
            element:Lock("In Game only")
        end
    end)
end

















-- Tab Main Mtab
local Mtab2 = Mtab:CreateSection("Player")
local Mtab1 = Mtab:CreateSection("Misc")

-- Person Mode  
Mtab:CreateToggle({  
    Name = "Person Mode",  
    SectionParent = Mtab2,  
    CurrentValue = false,  
    Callback = function(enabled)  
        local player = game.Players.LocalPlayer  
        if enabled then  
            player.CameraMode = Enum.CameraMode.Classic  
        else  
            player.CameraMode = Enum.CameraMode.LockFirstPerson  
        end  
    end,  
})  
  
-- Infinite Jump Toggle  
local infJump  
local infJumpDebounce = false  
  
Mtab:CreateToggle({  
    Name = "InfJump",  
    SectionParent = Mtab2,  
    CurrentValue = false,  
    Callback = function(enabled)  
        if enabled then  
            if infJump then infJump:Disconnect() end  
            infJumpDebounce = false  
            infJump = game:GetService("UserInputService").JumpRequest:Connect(function()  
                if not infJumpDebounce then  
                    infJumpDebounce = true  
                    local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid")  
                    if humanoid then  
                        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)  
                    end  
                    task.wait()  
                    infJumpDebounce = false  
                end  
            end)  
        else  
            if infJump then infJump:Disconnect() end  
            infJumpDebounce = false  
        end  
    end,  
})  
  
-- Noclip Toggle  
local Clip = true  
local Noclipping  
local floatName = "HumanoidRootPart"  
  
Mtab:CreateToggle({  
    Name = "Noclip",  
    SectionParent = Mtab2,  
    CurrentValue = false,  
    Callback = function(enabled)  
        local RunService = game:GetService("RunService")  
        local player = game.Players.LocalPlayer  
        if enabled then  
            Clip = false  
            task.wait(0.1)  
            local function NoclipLoop()  
                if not Clip and player.Character then  
                    for _, part in pairs(player.Character:GetDescendants()) do  
                        if part:IsA("BasePart") and part.CanCollide and part.Name ~= floatName then  
                            part.CanCollide = false  
                        end  
                    end  
                end  
            end  
            Noclipping = RunService.Stepped:Connect(NoclipLoop)  
        else  
            if Noclipping then Noclipping:Disconnect() end  
            Clip = true  
        end  
    end,  
})  
  
-- Khai báo dịch vụ  
local PromptService = game:GetService("ProximityPromptService")  
local Workspace = game:GetService("Workspace")  
  
-- Toggle: Instant Prompt  
Mtab:CreateToggle({  
    Name = "Instant interact",  
    SectionParent = Mtab2,  
    CurrentValue = false,  
    Callback = function(enabled)  
        if enabled then  
            for _, v in ipairs(Workspace:GetDescendants()) do  
                if v:IsA("ProximityPrompt") then  
                    v.HoldDuration = 0  
                end  
            end  
  
            PromptService.PromptButtonHoldBegan:Connect(function(prompt)  
                if prompt:IsA("ProximityPrompt") then  
                    prompt.HoldDuration = 0  
                end  
            end)  
        end  
    end  
})

Mtab:CreateButton({
    Name = "inf edit",
    SectionParent = Mtab1,
    Interact = "Run",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/main/infedit"))()
    end
})

Mtab:CreateButton({
    Name = "Esp NPC",
    SectionParent = Mtab1,
    Interact = "Run",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/main/espnpc"))()
    end
})

Mtab:CreateButton({
    Name = "Player Esp",
    SectionParent = Mtab1,
    Interact = "Run",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/main/PlayerEsp"))()
    end
})

