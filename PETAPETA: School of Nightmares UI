-- Kiểm tra ID game
if game.PlaceId ~= 116387287343653 then
    return warn("Script only works in the specified game (ID: 116387287343653){悪夢の校舎 PETAPETA: School of nightmares}")
end

-- Thông báo khi đúng ID game
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "✓ Game Check Passed",
    Text = "Script is now executing...",
    Duration = 5
})

task.wait(1) -- Đợi 1s trước khi thực thi 

task.spawn(function()
-- Khai báo các dịch vụ cần thiết
local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local camera = workspace.CurrentCamera

-- Tải và khởi tạo thư viện GUI Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Tạo cửa sổ giao diện chính
local Window = Rayfield:CreateWindow({
    Name = "Script By Khang [PETAPETA: School of Nightmares]",
    LoadingTitle = "Loading Hub...",
    LoadingSubtitle = "Please wait",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MyHubFolder",
        FileName = "MyHubConfig"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    },
    KeySystem = false,
})

-- Thông báo đã tải
Rayfield:Notify({
    Title = "Welcome!",
    Content = "Script Loaded",
    Duration = 2
})


-- Tạo hàm ESP chung
local function autoESP(filterFn, color, labelText)
	task.spawn(function()
		while true do
			for _, obj in ipairs(workspace:GetDescendants()) do
				if filterFn(obj) then
					if not obj:FindFirstChild("AutoESP") then
						local hl = Instance.new("Highlight")
						hl.Name = "AutoESP"
						hl.OutlineColor = color
						hl.OutlineTransparency = 0
						hl.FillTransparency = 1
						hl.Parent = obj
					end
					if not obj:FindFirstChild("ESPLabel") and obj:IsA("BasePart") then
						local bill = Instance.new("BillboardGui", obj)
						bill.Name = "ESPLabel"
						bill.Size = UDim2.new(0, 100, 0, 40)
						bill.StudsOffset = Vector3.new(0, 2, 0)
						bill.AlwaysOnTop = true
						local txt = Instance.new("TextLabel", bill)
						txt.Size = UDim2.new(1, 0, 1, 0)
						txt.BackgroundTransparency = 1
						txt.TextColor3 = color
						txt.TextStrokeTransparency = 0.5
						txt.Text = labelText or obj.Name
						txt.Font = Enum.Font.Bodoni
						txt.TextScaled = true
					end
				end
			end
			task.wait(5)
		end
	end)
end

-- Tab chính
local mainTab = Window:CreateTab("Visual", eye)

-- ESP Buttons
mainTab:CreateButton({
    Name = "Esp Player",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/main/PlayerEsp"))()
    end,
})

mainTab:CreateSection("—————————————————————————————————————————")
mainTab:CreateButton({
	Name = "Esp PetaPeta",
	Callback = function()
task.spawn(function()
	local espColor = Color3.fromRGB(255, 133, 145) -- Đỏ
	local outlineColor = Color3.fromRGB(0, 0, 0) -- Viền chữ màu đen

	-- Tạo ESP
	local function createESP(item)
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "EnemyESP"
		billboard.AlwaysOnTop = true
		billboard.Size = UDim2.new(0, 100, 0, 40)
		billboard.StudsOffset = Vector3.new(0, 2, 0)
		billboard.MaxDistance = math.huge
		billboard.Parent = item

		local textLabel = Instance.new("TextLabel")
		textLabel.Parent = billboard
		textLabel.Text = "Peta Peta"
		textLabel.TextColor3 = espColor
		textLabel.TextStrokeColor3 = outlineColor
		textLabel.TextStrokeTransparency = 0
		textLabel.BackgroundTransparency = 1
		textLabel.Size = UDim2.new(1, 0, 1, 0)
		textLabel.Font = Enum.Font.Bodoni
		textLabel.TextScaled = true
	end

	local function checkForEnemies()
		for _, item in ipairs(workspace:GetDescendants()) do
			if item:IsA("Model") and item.Name == "EnemyModel" and not item:FindFirstChild("EnemyESP") then
				createESP(item)
			end
		end
	end

	workspace.DescendantAdded:Connect(function(descendant)
		if descendant:IsA("Model") and descendant.Name == "EnemyModel" then
			createESP(descendant)
		end
	end)

	checkForEnemies()
end)
	loadstring(game:HttpGet("https://protected-roblox-scripts.onrender.com/4ff8c4ca4bd5179cd082f640899fc8f3"))()
	end,
})

mainTab:CreateButton({
    Name = "Hard Mode",
    Callback = function()
        task.spawn(function()
	local function createESP(item, text, color)
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "PetaESP"
		billboard.AlwaysOnTop = true
		billboard.Size = UDim2.new(0, 100, 0, 40)
		billboard.StudsOffset = Vector3.new(0, 2, 0)
		billboard.MaxDistance = math.huge
		billboard.Parent = item

		local textLabel = Instance.new("TextLabel")
		textLabel.Parent = billboard
		textLabel.Text = text
		textLabel.TextColor3 = color
		textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
		textLabel.TextStrokeTransparency = 0
		textLabel.BackgroundTransparency = 1
		textLabel.Size = UDim2.new(1, 0, 1, 0)
		textLabel.Font = Enum.Font.Bodoni
		textLabel.TextScaled = true

		local highlight = Instance.new("Highlight")
		highlight.Name = "PetaHighlight"
		highlight.FillTransparency = 1
		highlight.OutlineColor = color
		highlight.OutlineTransparency = 0
		highlight.Parent = item
	end

	local function check()
		for _, item in ipairs(workspace:GetDescendants()) do
			if item:IsA("Model") then
				if item.Name == "Petapeta_02" and not item:FindFirstChild("PetaESP") then
					createESP(item, "Peta Peta", Color3.fromRGB(255, 0, 0))
				elseif item.Name == "Petapeta_03" and not item:FindFirstChild("PetaESP") then
					createESP(item, "Peta Peta", Color3.fromRGB(93, 0, 73))
				end
			end
		end
	end

	workspace.DescendantAdded:Connect(function(desc)
		if desc:IsA("Model") then
			if desc.Name == "Petapeta_02" then
				createESP(desc, "Peta Peta", Color3.fromRGB(255, 0, 0))
			elseif desc.Name == "Petapeta_03" then
				createESP(desc, "Peta Peta", Color3.fromRGB(93, 0, 73))
			end
		end
	end)

	check()
end)
    end,
})

mainTab:CreateSection("--------------------------------------------")

mainTab:CreateButton({
	Name = "Esp Key",
	Callback = function()
		task.spawn(function()
	local Players = game:GetService("Players")
	local LocalPlayer = Players.LocalPlayer
	local espColor = Color3.fromRGB(255, 255, 255)
	local outlineColor = Color3.fromRGB(0, 0, 0)

	local function getDistance(pos)
		local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
		local hrp = char:WaitForChild("HumanoidRootPart", 3)
		if hrp then
			return math.floor((hrp.Position - pos).Magnitude)
		end
		return 0
	end

	local function createESP(obj)
		if obj:FindFirstChild("ExitKeyESP") then return end

		local part = obj:IsA("BasePart") and obj or obj:FindFirstChildWhichIsA("BasePart")
		if not part then return end

		-- Billboard
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "ExitKeyESP"
		billboard.AlwaysOnTop = true
		billboard.Size = UDim2.new(0, 100, 0, 40)
		billboard.StudsOffset = Vector3.new(0, 2, 0)
		billboard.MaxDistance = math.huge
		billboard.Parent = part

		local textLabel = Instance.new("TextLabel")
		textLabel.Parent = billboard
		textLabel.Text = "Key | Dis: ..."
		textLabel.TextColor3 = espColor
		textLabel.TextStrokeColor3 = outlineColor
		textLabel.TextStrokeTransparency = 0
		textLabel.BackgroundTransparency = 1
		textLabel.Size = UDim2.new(1, 0, 1, 0)
		textLabel.Font = Enum.Font.Bodoni
		textLabel.TextScaled = true

		-- Cập nhật khoảng cách liên tục
		task.spawn(function()
			while billboard.Parent and textLabel.Parent do
				local success, dist = pcall(function()
					return getDistance(part.Position)
				end)
				if success then
					textLabel.Text = "Key | Dis: " .. dist
				end
				task.wait(0.3)
			end
		end)

		-- Highlight
		local highlight = Instance.new("Highlight")
		highlight.Name = "ExitKeyESP"
		highlight.FillTransparency = 1
		highlight.OutlineTransparency = 0
		highlight.OutlineColor = espColor
		highlight.Parent = obj
	end

	local function checkAll()
		for _, obj in ipairs(workspace:GetDescendants()) do
			if (obj:IsA("Model") or obj:IsA("BasePart")) and obj.Name == "ExitKey" then
				createESP(obj)
			end
		end
	end

	workspace.DescendantAdded:Connect(function(descendant)
		task.wait(0.1)
		if (descendant:IsA("Model") or descendant:IsA("BasePart")) and descendant.Name == "ExitKey" then
			createESP(descendant)
		end
	end)

	checkAll()
end)
	end,
})

mainTab:CreateButton({
    Name = "Esp Shoe shelf",
    Callback = function()
        local positions = {
	Vector3.new(-87.43, 19.75, -109.25),
	Vector3.new(14.15, 21.37, -77.56),
	Vector3.new(-87.08, 19.75, 109.10),
	Vector3.new(87.18, 19.75, -97.31),
	Vector3.new(10.72, 4.47, 110.44),
	Vector3.new(-87.34, 4.90, 109.36),
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

for _, pos in ipairs(positions) do
	local part = Instance.new("Part")
	part.Name = "Shoe shelf"
	part.Anchored = true
	part.CanCollide = false
	part.Transparency = 1
	part.Size = Vector3.new(2, 3, 2)
	part.Position = pos
	part.Parent = workspace

	local gui = Instance.new("BillboardGui")
	gui.Name = "ShoeShelfTag"
	gui.Adornee = part
	gui.AlwaysOnTop = true
	gui.Size = UDim2.new(0, 100, 0, 40)
	gui.StudsOffset = Vector3.new(0, 2, 0)
	gui.Parent = part

	local label = Instance.new("TextLabel", gui)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.fromRGB(185, 209, 255)
	label.TextStrokeTransparency = 0
	label.Font = Enum.Font.Bodoni
	label.TextScaled = true
	label.Text = "Shoe shelf | Dis: ..."

	-- Tự cập nhật khoảng cách
	RunService.RenderStepped:Connect(function()
		local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if hrp and part and part.Parent then
			local dist = (part.Position - hrp.Position).Magnitude
			label.Text = string.format("Shoe shelf | Dis: %.1f", dist)
		end
	end)
end
    end,
})

mainTab:CreateButton({
	Name = "Esp RareShardSpawnPoint",
	Callback = function()
		autoESP(function(p)
			return p:IsA("BasePart") and p.Name == "RareShardSpawnPoint"
		end, Color3.fromRGB(0, 255, 0), "RareShardSpawnPoint")
	end,
})

mainTab:CreateButton({
	Name = "Esp (Soon...SuperHard)",
	Callback = function()
		autoESP(function(p)
			return p:IsA("BasePart") and p.Name == "wait"
		end, Color3.fromRGB(255, 52, 52), "wait")
	end,
})








local TeleportTab = Window:CreateTab("Teleport", "map")
TeleportTab:CreateSection("Main Location")

-- Vị trí chính
local locations = {
    {Name = "Door", Position = Vector3.new(10.35, 4.51, 116.89)},
    {Name = "Safe Room", Position = Vector3.new(-62.83, 4.95, 114.93)},
    {Name = "Music Room", Position = Vector3.new(117.54, 19.80, -125.32)},
    {Name = "Teacher's Room", Position = Vector3.new(7.24, 19.80, 108.62)},
    {Name = "Secret", Position = Vector3.new(-46.67, 19.8, -94.98)},
    {Name = "Secret Room", Position = Vector3.new(62.95, 19.80, 118.94)},
    {Name = "Secret Room 2", Position = Vector3.new(-119.27, 4.95, -90.83)},
}
for _, loc in ipairs(locations) do
    TeleportTab:CreateButton({
        Name = "Go to " .. loc.Name,
        Callback = function()
            local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.CFrame = CFrame.new(loc.Position)
            end
        end
    })
end

TeleportTab:CreateButton({
	Name = "Go to nearest key",
	Callback = function()
		local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local function getHRP()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	return char:WaitForChild("HumanoidRootPart", 5)
end

local function getExitKeyNearest()
	local nearest, minDist = nil, math.huge
	local hrp = getHRP()
	if not hrp then return end

	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj.Name == "ExitKey" then
			local part = obj:FindFirstChildWhichIsA("BasePart")
			if part then
				local dist = (hrp.Position - part.Position).Magnitude
				if dist < minDist then
					minDist = dist
					nearest = part
				end
			end
		elseif obj:IsA("BasePart") and obj.Name == "ExitKey" then
			local dist = (hrp.Position - obj.Position).Magnitude
			if dist < minDist then
				minDist = dist
				nearest = obj
			end
		end
	end

	return nearest, minDist
end

local function safeTeleport(targetCFrame)
	local hrp = getHRP()
	if not hrp then return end

	-- Gỡ vật lý có thể gây trip
	for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
		if v:IsA("BasePart") then
			v.CanCollide = false
			v.Velocity = Vector3.zero
			v.RotVelocity = Vector3.zero
		end
	end

	task.wait() -- chờ vật lý ổn định
	hrp.Anchored = true
	hrp.CFrame = targetCFrame * CFrame.new(6, 6, 0)
	task.wait(0.1)
	hrp.Anchored = false
end

local function teleportToExitKey()
	local target, dist = getExitKeyNearest()
	if target then
		safeTeleport(target.CFrame)
		print("Đã dịch chuyển đến ExitKey | Dist:", math.floor(dist))
	else
		warn("Không tìm thấy ExitKey.")
	end
end

teleportToExitKey()
	end,
})

















local KTab = Window:CreateTab("Misc", "package")
KTab:CreateSection("Game")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local AutoZeniRunning = false
local ZeniConnection
local ZeniList = {}

KTab:CreateToggle({
	Name = "Auto Collect Cursed Shard",
	CurrentValue = false,
	Callback = function(state)
		AutoZeniRunning = state
		if state then
			local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
			local lastTriggerTime = {}

			local function scanZeni()
				ZeniList = {}
				for _, obj in ipairs(workspace:GetDescendants()) do
					if (obj:IsA("ProximityPrompt") or obj:IsA("ClickDetector") or obj.Name == "TouchInterest") and not obj:IsDescendantOf(LocalPlayer.Character) then
						local model = obj:FindFirstAncestorWhichIsA("Model")
						if model and model.Name:match("^Zeni_[1-3]$") then
							table.insert(ZeniList, {model = model, obj = obj})
						end
					end
				end
			end

			scanZeni()
			workspace.DescendantAdded:Connect(function(desc)
				if AutoZeniRunning and (desc:IsA("ProximityPrompt") or desc:IsA("ClickDetector") or desc.Name == "TouchInterest") then
					local model = desc:FindFirstAncestorWhichIsA("Model")
					if model and model.Name:match("^Zeni_[1-3]$") then
						table.insert(ZeniList, {model = model, obj = desc})
					end
				end
			end)

			local function triggerPrompt(obj)
				if not obj or not obj:IsDescendantOf(workspace) then return false end
				local success = false
				pcall(function()
					if obj:IsA("ProximityPrompt") then
						fireproximityprompt(obj, math.huge)
						success = true
					elseif obj:IsA("ClickDetector") then
						fireclickdetector(obj)
						success = true
					elseif obj:IsA("TouchTransmitter") or obj.Name == "TouchInterest" then
						local part = obj.Parent
						if part and part:IsA("BasePart") then
							firetouchinterest(HumanoidRootPart, part, 0)
							task.wait()
							firetouchinterest(HumanoidRootPart, part, 1)
							success = true
						end
					end
				end)
				return success
			end

			local function getClosestPart(model, refPos)
				local closest, minDist = nil, math.huge
				for _, part in ipairs(model:GetChildren()) do
					if part:IsA("BasePart") then
						local dist = (part.Position - refPos).Magnitude
						if dist < minDist then
							minDist = dist
							closest = part
						end
					end
				end
				return closest, minDist
			end

			ZeniConnection = RunService.Heartbeat:Connect(function()
				if not AutoZeniRunning or not LocalPlayer.Character then return end
				local HRP = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
				if not HRP then return end

				local now = tick()
				for i = #ZeniList, 1, -1 do
					local data = ZeniList[i]
					local model = data.model
					local obj = data.obj

					if not model or not model:IsDescendantOf(workspace) or not obj or not obj:IsDescendantOf(model) then
						table.remove(ZeniList, i)
						continue
					end

					if lastTriggerTime[model] and now - lastTriggerTime[model] < 2 then
						continue
					end

					local _, dist = getClosestPart(model, HRP.Position)
					if dist and dist <= 5 then
						local success = triggerPrompt(obj)
						if success then
							lastTriggerTime[model] = now
						else
							table.remove(ZeniList, i)
						end
					end
				end
			end)
		else
			if ZeniConnection then
				ZeniConnection:Disconnect()
				ZeniConnection = nil
			end
			ZeniList = {}
		end
	end
})

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local AutoKeyRunning = false
local KeyConnection
local KeyList = {}

KTab:CreateToggle({
	Name = "Auto Collect Key",
	CurrentValue = false,
	Callback = function(state)
		AutoKeyRunning = state
		if state then
			local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
			local lastTriggerTime = {}

			local function scanKeys()
				KeyList = {}
				for _, obj in ipairs(workspace:GetDescendants()) do
					if (obj:IsA("ProximityPrompt") or obj:IsA("ClickDetector") or obj.Name == "TouchInterest") and not obj:IsDescendantOf(LocalPlayer.Character) then
						local model = obj:FindFirstAncestorWhichIsA("Model")
						if model and model.Name == "ExitKey" then
							table.insert(KeyList, {model = model, obj = obj})
						end
					end
				end
			end

			scanKeys()
			workspace.DescendantAdded:Connect(function(desc)
				if AutoKeyRunning and (desc:IsA("ProximityPrompt") or desc:IsA("ClickDetector") or desc.Name == "TouchInterest") then
					local model = desc:FindFirstAncestorWhichIsA("Model")
					if model and model.Name == "ExitKey" then
						table.insert(KeyList, {model = model, obj = desc})
					end
				end
			end)

			local function triggerPrompt(obj)
				if not obj or not obj:IsDescendantOf(workspace) then return false end
				local success = false
				pcall(function()
					if obj:IsA("ProximityPrompt") then
						fireproximityprompt(obj, math.huge)
						success = true
					elseif obj:IsA("ClickDetector") then
						fireclickdetector(obj)
						success = true
					elseif obj:IsA("TouchTransmitter") or obj.Name == "TouchInterest" then
						local part = obj.Parent
						if part and part:IsA("BasePart") then
							firetouchinterest(HumanoidRootPart, part, 0)
							task.wait()
							firetouchinterest(HumanoidRootPart, part, 1)
							success = true
						end
					end
				end)
				return success
			end

			local function getClosestPart(model, refPos)
				local closest, minDist = nil, math.huge
				for _, part in ipairs(model:GetChildren()) do
					if part:IsA("BasePart") then
						local dist = (part.Position - refPos).Magnitude
						if dist < minDist then
							minDist = dist
							closest = part
						end
					end
				end
				return closest, minDist
			end

			KeyConnection = RunService.Heartbeat:Connect(function()
				if not AutoKeyRunning or not LocalPlayer.Character then return end
				local HRP = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
				if not HRP then return end

				local now = tick()
				for i = #KeyList, 1, -1 do
					local data = KeyList[i]
					local model = data.model
					local obj = data.obj

					if not model or not model:IsDescendantOf(workspace) or not obj or not obj:IsDescendantOf(model) then
						table.remove(KeyList, i)
						continue
					end

					if lastTriggerTime[model] and now - lastTriggerTime[model] < 2 then
						continue
					end

					local _, dist = getClosestPart(model, HRP.Position)
					if dist and dist <= 3 then
						local success = triggerPrompt(obj)
						if success then
							lastTriggerTime[model] = now
						else
							table.remove(KeyList, i)
						end
					end
				end
			end)
		else
			if KeyConnection then
				KeyConnection:Disconnect()
				KeyConnection = nil
			end
			KeyList = {}
		end
	end
})

local HumanModCons = {}  
local Camera = workspace.CurrentCamera
local DefaultFOV = Camera.FieldOfView
local TargetFOV = 104

KTab:CreateToggle({  
	Name = "Inf Sprint (max upgrade)",  
	CurrentValue = false,  
	Flag = "SpeedToggle",  
	Callback = function(state)  
		local speaker = game.Players.LocalPlayer  
		local function isNumber(val)  
			return typeof(val) == "number" and val == val and val ~= math.huge and val ~= -math.huge  
		end  
  
		if state then  
			-- Đặt FOV mục tiêu  
			Camera.FieldOfView = TargetFOV

			-- Giữ FOV cố định nếu bị thay đổi  
			HumanModCons.fovChanged = Camera:GetPropertyChangedSignal("FieldOfView"):Connect(function()  
				if Camera.FieldOfView ~= TargetFOV then  
					Camera.FieldOfView = TargetFOV  
				end  
			end)

			local args = { true, 22 }  
			local speed = args[1] or 16  
			if args[2] then  
				speed = args[2]  
			end  
  
			if isNumber(speed) then  
				local Char = speaker.Character or workspace:FindFirstChild(speaker.Name)  
				local Human = Char and Char:FindFirstChildWhichIsA("Humanoid")  
  
				local function WalkSpeedChange()  
					if Char and Human then  
						Human.WalkSpeed = speed  
					end  
				end  
  
				WalkSpeedChange()  
  
				HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false)  
					or Human:GetPropertyChangedSignal("WalkSpeed"):Connect(WalkSpeedChange)  
  
				HumanModCons.wsCA = (HumanModCons.wsCA and HumanModCons.wsCA:Disconnect() and false)  
					or speaker.CharacterAdded:Connect(function(nChar)  
						Char, Human = nChar, nChar:WaitForChild("Humanoid")  
						WalkSpeedChange()  
						HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false)  
							or Human:GetPropertyChangedSignal("WalkSpeed"):Connect(WalkSpeedChange)  
					end)  
			end  
		else  
			-- Trả lại FOV ban đầu khi tắt  
			Camera.FieldOfView = DefaultFOV

			-- Ngắt kết nối giữ FOV  
			if HumanModCons.fovChanged then  
				HumanModCons.fovChanged:Disconnect()  
				HumanModCons.fovChanged = nil  
			end

			HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false) or nil  
			HumanModCons.wsCA = (HumanModCons.wsCA and HumanModCons.wsCA:Disconnect() and false) or nil  
		end  
	end  
})

KTab:CreateSection("Player")

local RunService = game:GetService("RunService")
local speaker = game.Players.LocalPlayer
local noclipConnection
local diedConnection

KTab:CreateToggle({
	Name = "Noclip",
	Default = false,
	Flag = "NoclipToggle",
	Callback = function(state)
		if state then
			local char = speaker.Character or speaker.CharacterAdded:Wait()
			local humanoid = char:FindFirstChildOfClass("Humanoid")

			-- Kích hoạt Noclip
			noclipConnection = RunService.Stepped:Connect(function()
				local c = speaker.Character
				if not c then return end
				for _, part in ipairs(c:GetDescendants()) do
					if part:IsA("BasePart") then
						part.CanCollide = false
					end
				end
			end)

			-- Nếu chết thì tắt
			if humanoid then
				diedConnection = humanoid.Died:Connect(function()
					if noclipConnection then
						noclipConnection:Disconnect()
						noclipConnection = nil
					end
					if diedConnection then
						diedConnection:Disconnect()
						diedConnection = nil
					end
					-- Tắt nút
					KTab.Flags["NoclipToggle"] = false
				end)
			end
		else
			-- Hủy kết nối nếu đang bật
			if noclipConnection then
				noclipConnection:Disconnect()
				noclipConnection = nil
			end
			if diedConnection then
				diedConnection:Disconnect()
				diedConnection = nil
			end
		end
	end
})

-- Khai báo các dịch vụ cần thiết
local PromptService = game:GetService("ProximityPromptService")
local Workspace = game:GetService("Workspace")

-- Tạo Toggle để kích hoạt và tắt chức năng Instant Prompt
local InstantPromptToggle = KTab:CreateToggle({
    Name = "Instant interact",
    CurrentValue = false,  -- Mặc định tắt
    Callback = function(enabled)
        if enabled then
            -- Khi toggle bật, thiết lập tất cả ProximityPrompt có HoldDuration = 0
            for _, v in ipairs(Workspace:GetDescendants()) do
                if v:IsA("ProximityPrompt") then
                    v.HoldDuration = 0
                end
            end

            -- Tự động thiết lập HoldDuration = 0 khi có Prompt mới bắt đầu
            PromptService.PromptButtonHoldBegan:Connect(function(prompt)
                if prompt:IsA("ProximityPrompt") then
                    prompt.HoldDuration = 0
                end
            end)

            Rayfield:Notify({
                Title = "Instant Prompt Enabled",
                Content = "All proximity prompts now require no hold duration.",
                Duration = 2
            })
        else
            -- Khi toggle tắt, không thay đổi gì
            Rayfield:Notify({
                Title = "Instant Prompt Disabled",
                Content = "Proximity prompts will use default hold duration.",
                Duration = 2
            })
        end
    end,
})

local HumanModCons = {}

KTab:CreateToggle({
	Name = "Fast Speed (hard or Shard)",
	CurrentValue = false,
	Flag = "SpeedToggle",
	Callback = function(state)
		local speaker = game.Players.LocalPlayer
		local function isNumber(val)
			return typeof(val) == "number" and val == val and val ~= math.huge and val ~= -math.huge
		end

		if state then
			Rayfield:Notify({
				Title = "Note",
				Content = "Collecting while walking can cause a prompt error, causing the prompt to fail",
				Duration = 4,
				Image = 6026568198,
			})

			local args = { true, 50 }
			local speed = args[1] or 16
			if args[2] then
				speed = args[2]
			end

			if isNumber(speed) then
				local Char = speaker.Character or workspace:FindFirstChild(speaker.Name)
				local Human = Char and Char:FindFirstChildWhichIsA("Humanoid")

				local function WalkSpeedChange()
					if Char and Human then
						Human.WalkSpeed = speed
					end
				end

				WalkSpeedChange()

				HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false)
					or Human:GetPropertyChangedSignal("WalkSpeed"):Connect(WalkSpeedChange)

				HumanModCons.wsCA = (HumanModCons.wsCA and HumanModCons.wsCA:Disconnect() and false)
					or speaker.CharacterAdded:Connect(function(nChar)
						Char, Human = nChar, nChar:WaitForChild("Humanoid")
						WalkSpeedChange()
						HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false)
							or Human:GetPropertyChangedSignal("WalkSpeed"):Connect(WalkSpeedChange)
					end)
			end
		else
			HumanModCons.wsLoop = (HumanModCons.wsLoop and HumanModCons.wsLoop:Disconnect() and false) or nil
			HumanModCons.wsCA = (HumanModCons.wsCA and HumanModCons.wsCA:Disconnect() and false) or nil
		end
	end
})

-- Hàm lấy RootPart an toàn
local function getRoot(char)
	return char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
end

local AmbientRunning = false

KTab:CreateToggle({
	Name = "Ambient Light",
	Default = false,
	Callback = function(state)
		AmbientRunning = state
		local speaker = game.Players.LocalPlayer

		local function applyAmbient(char)
			local root = char:WaitForChild("HumanoidRootPart", 3)
			if not root then return end

			if AmbientRunning then
				if not root:FindFirstChild("AmbientLight") then
					local light = Instance.new("PointLight")
					light.Name = "AmbientLight"
					light.Parent = root
					light.Range = 100
					light.Brightness = 0.1
					light.Color = Color3.fromRGB(255, 255, 255)
				end
			else
				local existing = root:FindFirstChild("AmbientLight")
				if existing then existing:Destroy() end
			end
		end

		local char = speaker.Character or speaker.CharacterAdded:Wait()
		applyAmbient(char)

		-- Theo dõi khi respawn
		if not AmbientConnection then
			AmbientConnection = speaker.CharacterAdded:Connect(function(newChar)
				if AmbientRunning then
					task.wait(1)
					applyAmbient(newChar)
				end
			end)
		end
	end
})

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local jumpGui

KTab:CreateToggle({
    Name = "Show Jump Button",
    CurrentValue = false,
    Callback = function(state)
        if state then
			Rayfield:Notify({
				Title = "Note",
				Content = " You can get a permanent trip if you jump in the closet",
				Duration = 4, 
				Image = 6026568198,
			})
            -- Nếu GUI đã tồn tại thì không tạo nữa
            if jumpGui and jumpGui.Parent then
                jumpGui.Enabled = true
                return
            end

            -- Tạo GUI mới
            jumpGui = Instance.new("ScreenGui")
            jumpGui.Name = "JumpButtonGui"
            jumpGui.ResetOnSpawn = false
            jumpGui.IgnoreGuiInset = true
            jumpGui.Parent = game:GetService("CoreGui")

            local outer = Instance.new("Frame")
            outer.Size = UDim2.new(0, 117 * 1.3, 0, 117 * 1.29)
            outer.Position = UDim2.new(0, 1034 - ((117 * 1.29 - 117)/2), 0, 388 - ((117 * 1.29 - 117)/2))
            outer.BackgroundColor3 = Color3.new(0, 0, 0)
            outer.BackgroundTransparency = 1
            outer.Parent = jumpGui

            local outerCorner = Instance.new("UICorner")
            outerCorner.CornerRadius = UDim.new(1, 0)
            outerCorner.Parent = outer

            local inner = Instance.new("Frame")
            inner.Size = UDim2.new(0, 99 * 1.3, 0, 99 * 1.29)
            inner.Position = UDim2.new(0, 9 * 1.3, 0, 9 * 1.29)
            inner.BackgroundColor3 = Color3.new(0, 0, 0)
            inner.BackgroundTransparency = 1
            inner.Parent = outer

            local innerCorner = Instance.new("UICorner")
            innerCorner.CornerRadius = UDim.new(1, 0)
            innerCorner.Parent = inner

            local stroke = Instance.new("UIStroke")
            stroke.Thickness = 4
            stroke.Color = Color3.new(1, 1, 1)
            stroke.Transparency = 1
            stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            stroke.Parent = inner

            local btn = Instance.new("ImageButton")
            btn.Size = UDim2.new(1, 0, 1, 0)
            btn.BackgroundTransparency = 1
            btn.Image = "rbxasset://textures/ui/Input/TouchControlsSheetV2.png"
            btn.ImageRectOffset = Vector2.new(1, 146)
            btn.ImageRectSize = Vector2.new(144, 144)
            btn.Parent = inner

            local flag = Instance.new("StringValue")
            flag.Name = "ButtonType"
            flag.Value = "Jump"
            flag.Parent = btn

            local holding = false

            local function jumpLoop()
                while holding do
                    local char = LocalPlayer.Character
                    local hum = char and char:FindFirstChildWhichIsA("Humanoid")
                    if hum and hum:GetState() ~= Enum.HumanoidStateType.Jumping and hum:GetState() ~= Enum.HumanoidStateType.Freefall then
                        hum:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                    task.wait(0.2)
                end
            end

            btn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                    if not holding then
                        holding = true
                        task.spawn(jumpLoop)
                    end
                end
            end)

            btn.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                    holding = false
                end
            end)

        else
            if jumpGui then
                jumpGui:Destroy()
                jumpGui = nil
            end
        end
task.spawn(function()
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function setJumpHeight()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hum = char:WaitForChild("Humanoid")

	-- Đặt độ cao nhảy thành 3 stud
	hum.UseJumpPower = false
	hum.JumpHeight = 3
end

-- Áp dụng ngay lập tức
setJumpHeight() 

-- Đảm bảo khi respawn vẫn giữ JumpHeight
LocalPlayer.CharacterAdded:Connect(function()
	setJumpHeight()
end)
end)
    end
})

KTab:CreateSection("Other")

KTab:CreateButton({
    Name = "Enable Anti-Void",
    Callback = function()
        task.spawn(function()
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

            -- Tạo Anti-Void Part
            local antiVoid = Instance.new("Part")
            antiVoid.Anchored = true
            antiVoid.CanCollide = false
            antiVoid.Transparency = 1
            antiVoid.Size = Vector3.new(5000, 1, 5000)
            antiVoid.Position = Vector3.new(94.80, -113.40, 409.71)
            antiVoid.Name = "AntiVoidPlatform"
            antiVoid.Parent = workspace

            -- Kết nối sự kiện chạm
            antiVoid.Touched:Connect(function(hit)
                if hit and hit:IsDescendantOf(LocalPlayer.Character) then
                    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        hrp.CFrame = CFrame.new(-44.42, 6.22, 96.75)
                    end
                end
            end)
        end)
    end,
})

KTab:CreateButton({
    Name = "Safe Button(hard or shard",
    Callback = function()
        local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Xóa GUI cũ nếu có
if PlayerGui:FindFirstChild("SafeZGui") then
	PlayerGui.SafeZGui:Destroy()
end

-- Tạo ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SafeZGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

-- Tạo Frame (nền của GUI), tăng kích thước 1.3 lần
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 65) -- 200x50 * 1.3
frame.Position = UDim2.new(0, 100, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

-- Bo góc cho Frame
local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 3)
frameCorner.Parent = frame

-- Tạo TextButton
local button = Instance.new("TextButton")
button.Size = UDim2.new(0.7, 0, 0.9, 0) -- Nhỏ hơn Frame một chút để không che
button.Position = UDim2.new(0.025, 0, 0.05, 0)
button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSans
button.TextScaled = true
button.Text = "SafeZone"
button.Parent = frame

-- Bo góc cho nút
local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 3)
buttonCorner.Parent = button

-- Tạo biến lưu vị trí gốc
local savedPosition = nil
local teleported = false

button.MouseButton1Click:Connect(function()
	local char = LocalPlayer.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	if not teleported then
		-- Lưu lại vị trí ban đầu
		savedPosition = hrp.CFrame
		-- TP đến SafeZ
		hrp.Velocity = Vector3.zero -- Ngăn trip
		hrp.CFrame = CFrame.new(1.65, 4.95, 34.88)
		teleported = true
		button.Text = "Back"
	else
		-- TP về vị trí cũ
		if savedPosition then
			hrp.Velocity = Vector3.zero -- Ngăn trip khi trở lại
			hrp.CFrame = savedPosition
		end
		teleported = false
		button.Text = "SafeZone"
	end
end)
end,
})

KTab:CreateButton({
    Name = "interact aura",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/CollectAura"))()
    end,
})

KTab:CreateButton({
    Name = "maxtnt05",
    Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/RLzFFC9z"))()
    end,
})
  
  KTab:CreateButton({
    Name = "Inf Yield Edit",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/infedit"))()
    end,
  })

end)







































local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local payload = {
    content = "✅ Người dùng " .. Players.LocalPlayer.Name .. " đã sử dụng script!",
    username = "Logger"
}

pcall(function()
    HttpService:PostAsync(
        "https://script.google.com/macros/s/AKfycbzhxmPgbonSyz0g6AltadxEIeYm5YEULC_ST556S8EvBvqmGvJVR51yVKTvWsXimkIq/exec",
        HttpService:JSONEncode(payload),
        Enum.HttpContentType.ApplicationJson
    )
end)