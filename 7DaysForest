-- Kiểm tra ID game
if game.PlaceId ~= 121308443347459 then
    return warn("Script only works in the specified game (ID: 121308443347459){7Days To Live (Forest)}")
end

-- Thông báo khi đúng ID game
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "✓ Game Check Passed",
    Text = "Script is now executing...",
    Duration = 5
})

task.wait(3) -- Đợi 3s trước khi thực thi 

task.spawn(function()
-- Khai báo các dịch vụ cần thiết
local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local camera = workspace.CurrentCamera

-- Tải và khởi tạo thư viện GUI Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Tạo cửa sổ giao diện chính
local Window = Rayfield:CreateWindow({
    Name = "Script By Khang",
    LoadingTitle = "Loading Hub...",
    LoadingSubtitle = "Please wait",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MyHubFolder",
        FileName = "MyHubConfig"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    },
    KeySystem = false,
})

-- Thông báo đã tải
Rayfield:Notify({
    Title = "Welcome!",
    Content = "Script Loaded",
    Duration = 2
})

-- Tạo Tab Main
local MTab = Window:CreateTab("Main", "home")
MTab:CreateSection("Main")

MTab:CreateButton({
    Name = "Esp Npc",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/7DayToLive/refs/heads/main/Esp%20Npc"))()
    end,
})
  
  MTab:CreateButton({
    Name = "Aimbot (Some npc may not work)",
    Callback = function()
      loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/Aimbot%20npc%207%20days"))()
    end,
  })

local toggleRunning = false
local connection

MTab:CreateToggle({
	Name = "GetBerry [INF]",
	CurrentValue = false,
	Flag = "GetBerryINF",
	Callback = function(state)
		toggleRunning = state

		local lp = game:GetService("Players").LocalPlayer
		local RunService = game:GetService("RunService")

		if connection then
			connection:Disconnect()
			connection = nil
		end

		local char = lp.Character or lp.CharacterAdded:Wait()
		local hrp = char:WaitForChild("HumanoidRootPart")
		local hum = char:FindFirstChildOfClass("Humanoid")
		if not (hrp and hum) then return end

		local originalCFrame = hrp.CFrame

		if not state then
			char:PivotTo(originalCFrame)
			return
		end

		connection = RunService.Heartbeat:Connect(function()
			if not toggleRunning then return end

			char = lp.Character or lp.CharacterAdded:Wait()
			hrp = char:FindFirstChild("HumanoidRootPart")
			hum = char:FindFirstChildOfClass("Humanoid")
			if not (hrp and hum) then return end

			local nearestBerry, shortestDist = nil, math.huge
			for _, obj in ipairs(workspace:GetDescendants()) do
				if obj:IsA("Model") and obj.Name:lower() == "berry" then
					local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
					if part then
						local dist = (hrp.Position - part.Position).Magnitude
						if dist < shortestDist then
							nearestBerry = obj
							shortestDist = dist
						end
					end
				end
			end

			if nearestBerry then
				local part = nearestBerry.PrimaryPart or nearestBerry:FindFirstChildWhichIsA("BasePart")
				if not nearestBerry.PrimaryPart and part then
					pcall(function()
						nearestBerry.PrimaryPart = part
					end)
				end

				local prompt = nearestBerry:FindFirstChildWhichIsA("ProximityPrompt", true)
					or nearestBerry:FindFirstChildWhichIsA("ClickDetector", true)
					or nearestBerry:FindFirstChild("TouchInterest", true)

				if prompt and part then
					char:PivotTo(part.CFrame + Vector3.new(0, 3.5, 0))
					task.wait(0.25)

					for i = 1, 50 do
						pcall(function()
							if prompt:IsA("ProximityPrompt") then
								fireproximityprompt(prompt)
							elseif prompt:IsA("ClickDetector") then
								fireclickdetector(prompt)
							elseif prompt.Name == "TouchInterest" then
								firetouchinterest(hrp, part, 0)
								task.wait()
								firetouchinterest(hrp, part, 1)
							end
						end)
						task.wait(0.05)
					end

					task.wait(0.2)
					char:PivotTo(originalCFrame)
					task.wait(1) -- Chờ 1 giây trước lần lặp kế tiếp
				end
			else
				task.wait(1)
			end
		end)
	end
})

local autoScrapRunning = false
local autoScrapConnection
local savedCFrame = nil

MTab:CreateToggle({
	Name = "Auto Scrap",
	CurrentValue = false,
	Flag = "AutoScrapToggle",
	Callback = function(state)
		local lp = game:GetService("Players").LocalPlayer
		local RunService = game:GetService("RunService")

		-- Tắt toggle thủ công
		if not state then
			autoScrapRunning = false
			if autoScrapConnection then
				autoScrapConnection:Disconnect()
				autoScrapConnection = nil
			end

			Rayfield:Notify({
				Title = "Auto Scrap",
				Content = "Auto Scraps disabled",
				Duration = 3
			})

			task.delay(1, function()
				local char = lp.Character or lp.CharacterAdded:Wait()
				local hrp = char:FindFirstChild("HumanoidRootPart")
				if hrp and savedCFrame then
					char:PivotTo(savedCFrame)
					Rayfield:Notify({
						Title = "Auto Scrap",
						Content = "Teleport successful ",
						Duration = 2
					})
				end
			end)

			return
		end

		-- Bật toggle
		autoScrapRunning = true
		local char = lp.Character or lp.CharacterAdded:Wait()
		local hrp = char:WaitForChild("HumanoidRootPart")
		if not hrp then return end
		savedCFrame = hrp.CFrame

		Rayfield:Notify({
			Title = "Auto Scrap",
			Content = "Searching and collecting Scrap...",
			Duration = 3
		})

		autoScrapConnection = RunService.Heartbeat:Connect(function()
			if not autoScrapRunning then return end

			local char = lp.Character or lp.CharacterAdded:Wait()
			local hrp = char:FindFirstChild("HumanoidRootPart")
			if not hrp then return end

			local foundScrap = false

			for _, obj in ipairs(workspace:GetDescendants()) do
				if not autoScrapRunning then break end
				if obj:IsA("Model") and obj.Name:lower() == "scrap" then
					local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
					local prompt = obj:FindFirstChildWhichIsA("ProximityPrompt", true)
						or obj:FindFirstChildWhichIsA("ClickDetector", true)
						or obj:FindFirstChild("TouchInterest", true)

					if part then
						foundScrap = true
						char:PivotTo(part.CFrame + Vector3.new(0, 2, 0))
						task.wait(0.2)

						if not prompt then
							autoScrapRunning = false
							if autoScrapConnection then
								autoScrapConnection:Disconnect()
								autoScrapConnection = nil
							end

							Rayfield:Notify({
								Title = "Auto Scrap",
								Content = "Collected all Scrap, preparing TP",
								Duration = 3
							})

							task.delay(1, function()
								local char = lp.Character or lp.CharacterAdded:Wait()
								local hrp = char:FindFirstChild("HumanoidRootPart")
								if hrp and savedCFrame then
									char:PivotTo(savedCFrame)
									Rayfield:Notify({
										Title = "Auto Scrap",
										Content = "Teleported successfully",
										Duration = 2
									})
								end
							end)
							break
						end

						pcall(function()
							if prompt:IsA("ProximityPrompt") then
								fireproximityprompt(prompt)
							elseif prompt:IsA("ClickDetector") then
								fireclickdetector(prompt)
							elseif prompt.Name == "TouchInterest" then
								firetouchinterest(hrp, part, 0)
								task.wait()
								firetouchinterest(hrp, part, 1)
							end
						end)

						task.wait(0.1)
					end
				end
			end

			if not foundScrap then
				autoScrapRunning = false
				if autoScrapConnection then
					autoScrapConnection:Disconnect()
					autoScrapConnection = nil
				end

				Rayfield:Notify({
					Title = "Auto Scrap",
					Content = "Scrap has been collected, prepare TP",
					Duration = 3
				})

				task.delay(1, function()
					local char = lp.Character or lp.CharacterAdded:Wait()
					local hrp = char:FindFirstChild("HumanoidRootPart")
					if hrp and savedCFrame then
						char:PivotTo(savedCFrame)
						Rayfield:Notify({
							Title = "Auto Scrap",
							Content = "Teleport successful",
							Duration = 2
						})
					end
				end)
			end
		end)
	end
})

MTab:CreateButton({
    Name = "Eat Berry Button (Full Hungry)",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/7DayToLive/refs/heads/main/EatBerryButton"))()
    end,
})

MTab:CreateSection("Esp")
-- Esp home button (Rayfield GUI - MTab)
MTab:CreateButton({
    Name = "Esp home",
    Callback = function()
        -- Xóa part cũ nếu đã tồn tại
        if workspace:FindFirstChild("HomeESPPart") then
            workspace.HomeESPPart:Destroy()
        end

        -- Tạo part tàng hình không thể chạm
        local part = Instance.new("Part")
        part.Name = "HomeESPPart"
        part.Anchored = true
        part.CanCollide = false
        part.CanTouch = false
        part.Transparency = 1
        part.Size = Vector3.new(1, 1, 1)
        part.Position = Vector3.new(56.44, 70.12, 417.58)
        part.Parent = workspace

        -- Tạo BillboardGui hiển thị chữ "Home"
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESP"
        billboard.Size = UDim2.new(0, 100, 0, 20)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        billboard.Adornee = part
        billboard.Parent = part

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = "Home"
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextStrokeTransparency = 0
        label.Font = Enum.Font.SourceSansBold
        label.TextScaled = true
        label.TextSize = 15 -- Giới hạn kích thước chữ
        label.Parent = billboard
    end
})

local TeleportTab = Window:CreateTab("Teleport", "map")
TeleportTab:CreateSection("Main Location")

local players = game:GetService("Players")
local lplr = players.LocalPlayer
local selectedPlayer = nil
local offsetDistance = 10

-- Danh sách vị trí chính
local locations = {
    {Name = "Home", Position = Vector3.new(60.99, 48.58, 417.10)},
    {Name = "Balcony", Position = Vector3.new(37.34, 52.72, 420.62)},
    {Name = "River", Position = Vector3.new(-227.99, -0.84, 341.59)},
    {Name = "Skeleton", Position = Vector3.new(145.43, 12.63, 234.22)},
    {Name = "Turret1", Position = Vector3.new(-110.91, 37.91, 352.01)},
    {Name = "Turret2", Position = Vector3.new(-5.95, 26.77, 258.23)},
    {Name = "Turret3", Position = Vector3.new(117.83, 34.97, 336.75)},
    {Name = "Turret4", Position = Vector3.new(95.04, 34.41, 491.53)},
    {Name = "Helicopter", Position = Vector3.new(-318.54, 30.69, 110.7)},
}

for _, loc in ipairs(locations) do
    TeleportTab:CreateButton({
        Name = "Go to " .. loc.Name,
        Callback = function()
            local hrp = lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.CFrame = CFrame.new(loc.Position)
            end
        end
    })
end

-- Section mới: Players
TeleportTab:CreateSection("Players")

-- Dropdown chọn người chơi
TeleportTab:CreateDropdown({
    Name = "Select Player",
    Options = {},
    Callback = function(value)
        selectedPlayer = value
    end
})

-- Cập nhật danh sách người chơi động
task.spawn(function()
    while true do
        local names = {}
        for _, plr in ipairs(players:GetPlayers()) do
            if plr ~= lplr then
                table.insert(names, plr.Name)
            end
        end
        TeleportTab:UpdateDropdown("Select Player", names)
        task.wait(3)
    end
end)

-- Thanh kéo chỉnh khoảng cách
TeleportTab:CreateSlider({
    Name = "Distance Behind (studs)",
    Min = 0,
    Max = 100,
    Default = 10,
    Callback = function(value)
        offsetDistance = value
    end
})

-- Nút Go to Player
TeleportTab:CreateButton({
    Name = "Go to Player",
    Callback = function()
        local targetPlayer = players:FindFirstChild(selectedPlayer)
        local hrp = lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart")
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and hrp then
            local targetHRP = targetPlayer.Character.HumanoidRootPart
            local back = -targetHRP.CFrame.LookVector * offsetDistance
            hrp.CFrame = CFrame.new(targetHRP.Position + back)
        end
    end
})

local KTab = Window:CreateTab("Misc", "package")
  
KTab:CreateButton({
    Name = "Collect Aura",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/CollectAura"))()
    end,
})
  
  KTab:CreateButton({
    Name = "Inf Yield Edit",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/infedit"))()
    end,
  })

KTab:CreateButton({
     Name = "Herkle Hub",
     Callback = function()
         loadstring(game:HttpGet("https://raw.githubusercontent.com/decryp1/Herkle-Hub/refs/heads/main/game%20redirect"))()
     end,
})

KTab:CreateButton({
    Name = "Players ESP",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/idtkby/Xd/refs/heads/main/PlayerEsp"))()
    end,
})

KTab:CreateButton({
    Name = "Enable Chat",
    Callback = function()
        local StarterGui = game:GetService("StarterGui")
local TextChatService = game:GetService("TextChatService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Bật lại Chat GUI nếu bị tắt
pcall(function()
    StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, true)
end)

-- Bật lại ChatWindow nếu bị ẩn
local function enableChatWindow()
    local config = TextChatService:FindFirstChild("ChatWindowConfiguration")
    if config then
        config.Enabled = true
    end
end

-- Kiểm tra định kỳ để đảm bảo không bị tắt lại
RunService.RenderStepped:Connect(function()
    if not StarterGui:GetCoreGuiEnabled(Enum.CoreGuiType.Chat) then
        StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, true)
    end
    enableChatWindow()
end)
    end,
})
  
end)
